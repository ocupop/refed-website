---
layout: policy_tool
title: Policy Tool
permalink: /tools/policy/

header: U.S. Food Waste Policy Finder
---

{% include policy/tooltip.html %}

{% include policy/policynav_map.html %}

<section class="transparent">
  {% include policy/page_header.html %}
  <div class="container mobilenav">
    <div  class="row">
      <div class="col-xs-12">
        <div class="content">
          <p>Select a policy filter below to view the States related to that policy</p>
          <a href="#liability-collapse" class="button recovery" data-toggle="collapse" aria-expanded="false" aria-controls="liability-collapse">Liability Protection</a>
          <div class="collapse" id="liability-collapse">
            <img src="http://placehold.it/720x375?text=Map Image" class="img-responsive" alt="">
            <a href="#liability-studies" class="sub-trigger" data-toggle="collapse" aria-expanded="false" aria-controls="liability-studies">Best-practice Policies <i class="icon-caret-up"></i></a>
            <div class="collapse" id="liability-studies">
              {% for case_study in site.data.policy_tool['liability_protection'].case_studies %}
                <div class="panel">
                  <h3>{{ case_study.state }} Liability Protection</h3>
                  <p>{{ case_study.summary}}</p>
                </div>
              {% endfor %}
            </div>
          </div>
          <a href="#tax-collapse" class="button recovery" data-toggle="collapse" aria-expanded="false" aria-controls="tax-collapse">Tax Incentives</a>
          <div class="collapse" id="tax-collapse">
            <img src="http://placehold.it/700x375?text=Map Image" class="img-responsive" alt="">
            <a href="#tax-studies" class="sub-trigger" data-toggle="collapse" aria-expanded="false" aria-controls="tax-studies"><img src="/img/icons/policy/recovery_study_icon.svg" alt="tax icon">Best Practice Policies <i class="icon-caret-up"></i></a>
            <div class="collapse" id="tax-studies">
              {% for case_study in site.data.policy_tool['tax_incentives'].case_studies %}
                <div class="panel">
                  <h3>{{ case_study.state }} Tax Incentives</h3>
                  <p>{{ case_study.summary}}</p>
                </div>
              {% endfor %}
            </div>
          </div>
          <a href="#feed-collapse" class="button recycling" data-toggle="collapse" aria-expanded="false" aria-controls="feed-collapse">Animal Feed</a>
          <div class="collapse" id="feed-collapse">
            <img src="http://placehold.it/700x375?text=Map Image" class="img-responsive" alt="">
            <a href="#feed-studies" class="sub-trigger" data-toggle="collapse" aria-expanded="false" aria-controls="feed-studies">Best Practice Policies <i class="icon-caret-up"></i></a>
            <div class="collapse" id="feed-studies">
              {% for case_study in site.data.policy_tool['animal_feed'].case_studies %}
                <div class="panel">
                  <h3>{{ case_study.state }}</h3>
                  <p>{{ case_study.summary}}</p>
                </div>
              {% endfor %}
            </div>
          </div>
          <a href="#waste-collapse" class="button recycling" data-toggle="collapse" aria-expanded="false" aria-controls="waste-collapse">Organic Waste Bans &amp; Waste Recycling Laws</a>
          <div class="collapse" id="waste-collapse">
            <img src="http://placehold.it/700x375?text=Map Image" class="img-responsive" alt="">
            <a href="#organics-studies" class="sub-trigger" data-toggle="collapse" aria-expanded="false" aria-controls="organics-studies">Best Practice Policies <i class="icon-caret-up"></i></a>
            <div class="collapse" id="organics-studies">
              {% for case_study in site.data.policy_tool['organics_recycling_mandates'].case_studies %}
                <div class="panel">
                  <h3>{{ case_study.state }}</h3>
                  <p>{{ case_study.summary}}</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row visible-xs visible-sm">
      <div class="col-md-5">
        <div class="content">
          <img src="http://placehold.it/710x320" class="img-responsive" alt="">
        </div>
      </div>
      <div id="spotlight" class="col-md-7">
        <div class="content">
          <h2>Spotlight on date labeling regulations</h2>
          <p>Current date labeling practices on food packaging cause confusion that leads to 20% of consumer waste of safe, edible food. Five to 10% of this could be impacted by standardizing policy around date labeling.</p>
          <a href="{{ site.baseurl }}/tools/policy/date-labels" class="button"><span>Learn More &nbsp;&gt;</span></a>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="row middle-xs center-xs">
      <div class="col-xs-12">
        <div id="map">
          {% include_relative _map_legend.html %}
        </div>
        <div id="map-instructions">
          <div class="content">
            <h4>U.S. Food Waste Policy Finder</h4>
            <p>Use this tool to research current food waste policy at the federal and state levels and to discover best practices and recommendations for policy improvements that will support more food waste prevention, recovery and recycling.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<script>

  $('#tooltip .close').on('click', function() {
    $('#tooltip').removeClass('active');
  });

  $('#state-select').change(function(){
    var url = $(this).val(); // get selected value
      if (url) { // require a URL
          window.location = url; // redirect
      }
      return false;
  });

  $('.map-filter, .map-subfilter').on('change', function(e) {
    var checked = $(this).prop("checked"),
        container = $(this).parent(),
        siblings = container.siblings();
    // window.console.log("CONTAINER: ", container);

    container.find('input[type="checkbox"]').prop({
      indeterminate: false,
      checked: checked
    });

    function checkSiblings(el) {

      var parent = el.parent().parent(),
          all = true;

      el.siblings().each(function() {
        return all = ($(this).children('input[type="checkbox"]').prop("checked") === checked);
      });

      if (all && checked) {

        parent.children('input[type="checkbox"]').prop({
          indeterminate: false,
          checked: checked
        });

        checkSiblings(parent);

      } else if (all && !checked) {

        parent.children('input[type="checkbox"]').prop("checked", checked);
        parent.children('input[type="checkbox"]').prop("indeterminate", (parent.find('input[type="checkbox"]:checked').length > 0));
        checkSiblings(parent);

      } else {

        el.parents("li").children('input[type="checkbox"]').prop({
          indeterminate: true,
          checked: false
        });

      }

    }

    checkSiblings(container);
    updateMapLevels();
  });

  $(".nav_category").each(function() {
    var $el = $(this),
        cat = $el.data('category');

    $el.find('.map-filter, .map-subfilter, .study-filter').on('click', function() {
      var checked = this.checked ? true : false;
      var bp = $(this).hasClass('study-filter');
      var activeNav = $el.find('.map-filter:checked, .map-subfilter:checked').length;
      window.console.log ($(this), bp);

      if(checked) {
        var showStudies = $el.find('.study-filter:checked').length;
        var section = $(this).closest('.section_root').attr('data-section');
        var activeClass = cat + " " + section;
        $(this).siblings('.collapse').collapse('show');

        $el.siblings('.nav_category').find('input[type="checkbox"]').prop({
          indeterminate: false,
          checked: false
        });
        if(!bp) {
          $el.find('.map-filter, .map-subfilter').not(this).prop({
            indeterminate: false,
            checked: false
          });
        }

        if(showStudies) {
          activeClass += " show-studies";
        }
        if(!activeNav) {
          clearLevels();
        }

        $('#map').attr('class', activeClass);

      } else {
        if(bp) { 
          $('#map').removeClass('show-studies');
        } else {
          clearLevels();
        }

      }
    });

    $el.find('.collapse').on('show.bs.collapse', function() {
      $el.siblings('.nav_category').find('.collapse').collapse('hide');
    });
  });


  function clearLevels() {
    $('path.states').removeClass(function (index, css) {
      return (css.match (/(^|\s)level-\S+/g) || []).join(' ');
    });
  }

  function getLevel(array, state) {
    return array.filter(item => item == state).length;
  }

  function updateMapLevels() {
    var activeStates = [];
    $(".map-subfilter").each(function() {
      if($(this).is(':checked')) {
        var states = $(this).data('states');
        states.forEach(function(state) {
          activeStates.push(state);
        });
      }
    });
    clearLevels();
    activeStates.forEach(function(state) {
      $('#'+state).addClass('level-'+getLevel(activeStates, state));
      // console.log(state, getLevel(activeStates, state));
    });
  }


</script>


<!-- Map -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>

<script type="text/javascript">
  String.prototype.trim = function(){
    return this.replace(" ", "-").toLowerCase();
  };

  /*  This visualization was made possible by modifying code provided by:


  */
  var width = 960,
      height = 500;

  var svg = d3.select("#map")
        .append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 "+width+" "+height+"");

  var projection = d3.geo.albersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);
   
  var path = d3.geo.path()
    .projection(projection);

  // Append Div for tooltip to SVG
  var tip = d3.select("#tooltip");
    
  queue()
    // .defer(d3.json, '/data/states.json')
    .defer(d3.json, '/data/us-states.json')
    .defer(d3.json, '/data/casestudies.json')
    .await(buildMap);

  function buildMap(error, states, casestudies) {

    svg.selectAll(".states")
      .data(states.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr('class', 'states')
      .attr('id', function(d) { return d.properties.name.trim(); })
      .on('click', function(d) {
        var url = "/states/"+d.properties.name.trim();
        window.location.href = url;
      });

    svg.selectAll('.study')
      .data(casestudies.features)
      .enter()
      .append('path')
      .attr('d', path.pointRadius(10))
      .attr('class', function(d) { return "study "+d.category; })
      .on("click", function(d) {
        $('#tooltip')
          .find('.title').text(d.properties.title).end()
          .find('.summary').text(d.properties.summary).end()
          .find('.button').attr('class', 'button '+d.category).end()
          .addClass('active');

        tip.style("left", (d3.event.pageX - 42) + "px")
          .style("top", (d3.event.pageY - 146) + "px");
      });
      // .on("mouseout", function(d) {
      //   tip.attr('class', 'hide')
      // });

  }
</script>

