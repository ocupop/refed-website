---
layout: policy_tool
title: Policy Tool
permalink: /tools/policy/
slug: policy-tool

header: "U.S. Food Waste Policy Finder"
---
<div id="tooltip">HELLO</div>
<div id="policynav">
  <div class="sticky">
    <h4 class="prevention">Prevention Policy</h4>
    <p>Policy changes related to date labelling have the potential to prevent 398,000 tons of waste per year</p>
    <ul>
      <li class="checkbox">
        <input id="date_labelling_filters" type="checkbox" value="">
        <label for="date_labelling_filters">
          <span></span>
          Date Labelling
          <small>Reveal state policies that hinder food waste prevention</small>
        </label>
      </li>
    </ul>
    <a href="/tools/policy/date-labels" class="button prevention">Explore date labeling<br>policy issues in depth &nbsp; &gt;</a>

    <h4 class="recovery">Recovery Policy</h4>
    <p>Federal policy provides liability protection and tax incentives for donating food. States have the opportunity to spur greater food recovery by enacting stronger policies in both areas.</p>
    {% assign section = site.data.policy_tool['liability_protection'] %}
    {% include tools/policy_tool_filter.html section=section %}

    {% assign section = site.data.policy_tool['tax_incentives'] %}
    {% include tools/policy_tool_filter.html section=section %}

    <h4 class="recycling">Recycling Policy</h4>
    <p>Increased food scrap recycling can be incentivized by these state and local policies.</p>
    {% assign section = site.data.policy_tool['animal_feed'] %}
    {% include tools/policy_tool_filter.html section=section %}
    
    {% assign section = site.data.policy_tool['organics_recycling_mandates'] %}
    {% include tools/policy_tool_filter.html section=section %}
  </div>
</div>
<section>
  <div class="container-fluid">
    <div class="row middle-xs center-xs">
      <div class="col-xs-12">
        <div id="federal-state-nav">
          <a href="/tools/policy/federal" class="button">Federal<br>Policy</a>
          <a href="#" class="button active">State<br>Policy</a>
        </div>
      </div>
    </div>
    <div class="row middle-xs center-xs">
      <div class="col-xs-12">
        <div id="map"></div>
        <div id="map-instructions" class="hide">
          <div class="content">
            <h4>U.S. Food Waste Policy Finder</h4>
            <p>Use this tool to research current food waste policy at the federal and state levels and to discover best practices and recommendations for policy improvements that will support more food waste prevention, recovery and recycling.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section>
  <div class="container-fluid">
    <div class="row middle-xs center-xs">
      <div class="col-xs-12 col-sm-4 col-md-3">
        <label for="state-select" class="text-left">Explore Food Waste Policy by State</label>
      </div>
      <div class="col-xs-12 col-sm-8 col-md-5">
        <div class="select">
          <select name="" id="state-select">
            <option>Choose State</option>
            {% for state in site.states %}
              <option value="{{ state.url }}">{{ state.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
  </div>
</section>



<script>
  $('#state-select').change(function(){
    var value = $(this).val();
    window.console.log('value', value);
    var url = $(this).val(); // get selected value
      if (url) { // require a URL
          window.location = url; // redirect
      }
      return false;
  });
  $('.map-filter, .map-subfilter').on('click', function() {
    var root = $(this).closest('.root');
    clearFilters(root);
  });
  $('.map-filter, .map-subfilter').on('change', function(e) {
    var checked = $(this).prop("checked"),
        container = $(this).parent(),
        siblings = container.siblings();
    // window.console.log("CONTAINER: ", container);

    container.find('input[type="checkbox"]').prop({
      indeterminate: false,
      checked: checked
    });

    function checkSiblings(el) {

      var parent = el.parent().parent(),
          all = true;

      el.siblings().each(function() {
        return all = ($(this).children('input[type="checkbox"]').prop("checked") === checked);
      });

      if (all && checked) {

        parent.children('input[type="checkbox"]').prop({
          indeterminate: false,
          checked: checked
        });

        checkSiblings(parent);

      } else if (all && !checked) {

        parent.children('input[type="checkbox"]').prop("checked", checked);
        parent.children('input[type="checkbox"]').prop("indeterminate", (parent.find('input[type="checkbox"]:checked').length > 0));
        checkSiblings(parent);

      } else {

        el.parents("li").children('input[type="checkbox"]').prop({
          indeterminate: true,
          checked: false
        });

      }

    }

    checkSiblings(container);
    updateMap();
  });

  function clearFilters(activeRoot) {
    $(".root").not(activeRoot).each(function() {
      window.console.log("CLEAR:", $(this));
      $(this).find('input[type="checkbox"]').prop({
        indeterminate: false,
        checked: false
      });
    });
  }

  function clearLevels() {
    $('path.states').removeClass(function (index, css) {
      return (css.match (/(^|\s)level-\S+/g) || []).join(' ');
    });
  }
  function getLevel(array, state) {
    return array.filter(item => item == state).length;
  }
  function updateMap() {
    var activeStates = [];
    $(".map-subfilter").each(function() {
      if($(this).is(':checked')) {
        var states = $(this).data('states');
        states.forEach(function(state) {
          activeStates.push(state);
        });
      }
    });
    clearLevels();
    activeStates.forEach(function(state) {
      $('#'+state).addClass('level-'+getLevel(activeStates, state));
      // console.log(state, getLevel(activeStates, state));
    });
  }

</script>


<!-- Map -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>

<script type="text/javascript">
  String.prototype.trim = function(){
    return this.replace(" ", "-").toLowerCase();
  };

  /*  This visualization was made possible by modifying code provided by:


  */
  var width = 960,
      height = 500;

  var svg = d3.select("#map")
        .append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 "+width+" "+height+"");

  var projection = d3.geo.albersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);
   
  var path = d3.geo.path()
    .projection(projection);

  // Append Div for tooltip to SVG
  var tip = d3.select("#tooltip");
    
  queue()
    // .defer(d3.json, '/data/states.json')
    .defer(d3.json, '/data/us-states.json')
    .defer(d3.json, '/data/cities.json')
    .await(buildMap);

  function buildMap(error, states, cities) {

    svg.selectAll(".states")
      .data(states.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr('class', 'states')
      .attr('id', function(d) { return d.properties.name.trim(); })
      .on('click', function(d) {
        var url = "/states/"+d.properties.name.trim();
        window.location.href = url;
      });

    // svg.selectAll('.cities')
    //   .data(cities.features)
    //   .enter()
    //   .append('path')
    //   .attr('d', path.pointRadius(5))
    //   .attr('class', 'cities')
    //   .on("mouseover", function(d) {
    //     tip.attr('class', 'active')
              // .style("left", (d3.event.pageX) + "px")
    //        .style("top", (d3.event.pageY - 150) + "px");
    //      window.console.log("hover", d);
    //   })
    //   .on("mouseout", function(d) {
        // tip.attr('class', 'hide')
    // }

  }
</script>

