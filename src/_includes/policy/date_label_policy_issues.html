<section>
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-md-5">
        <div class="panel">
          <div class="panel-body">
            <div id="carousel-date-label" class="carousel slide" data-ride="carousel" data-interval="false">
              <div class="carousel-inner" role="listbox">
                <div class="item active" data-progress="0">
                  <h2>Date Labeling<br>Policy Issues</h2>
                  <p>Exploring some of the food date label regulation patterns across the country reveals extreme variations among states and demonstrates how our current labeling system creates confusion for consumers while not necessarily improving food safety.</p>
                </div>
                {% for filter in site.data.policy_tool['date_labeling'].filters %}
                  <div class="item"
                       data-progress="{% cycle '20','40','60','80' %}"
                       data-states='{{ filter.states | jsonify }}'>
                    <h2>{{ filter.title }}</h2>
                    <p>{{ filter.definition }}</p>
                  </div>
                {% endfor %}
                  <div class="item explore" data-progress="100">
                    <h2>Explore Each State</h2>
                    <ul>
                      <li>
                        <span class="box"></span><span class="fineprint">No date label regulations
                      </li>
                      <li>
                        <span class="box"></span><span class="fineprint">Date labels required for certain foods<br>No restrictions on sales after those dates</span>
                      </li>
                      <li>
                        <span class="box"></span>
                        <span class="fineprint">
                          Date labels required for certain foods<br>
                          Regulations on sales after those dates
                        </span>
                      </li>
                      <li>
                        <span class="box"></span>
                        <span class="fineprint">
                          No date label regulations Regulations on sales after dates if date labels are voluntarily applied
                        </span>
                      </li>
                    </ul>
                  </div>
                </div>
            </div>
            
            <div class="row">
              <div class="col-xs-2">
                <a class="left" href="#carousel-date-label" role="button" data-slide="prev">
                  <i class="icon-prev"></i>
                  <span class="sr-only">Previous</span>
                </a>
              </div>
              <div class="col-xs-8">
                <div class="progress">
                  <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                    <span class="sr-only">0% Complete</span>
                  </div>
                </div>
              </div>
              <div class="col-xs-2">
                <a class="right" href="#carousel-date-label" role="button" data-slide="next">
                  <i class="icon-next"></i>
                  <span class="sr-only">Next</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-md-7">
        <div id="map"></div>
      </div>
    </div>
  </div>
</section>

{% include policy/explore_state_navigation.html %}

<script>
  $('#carousel-date-label').on('slid.bs.carousel', function (e) {
    window.console.log("slide");
    var direction = e.direction;
    var progress = $(e.relatedTarget).data("progress");
    window.console.log(direction);
    $('.progress-bar').css("width", progress + "%").attr("aria-valuenow", progress);
  });
</script>

<!-- Map -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>

<script type="text/javascript">
  String.prototype.trim = function(){
    return this.replace(" ", "-").toLowerCase();
  };

  var width = 960,
      height = 500;

  var svg = d3.select("#map")
        .append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 "+width+" "+height+"");

  var projection = d3.geo.albersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);
   
  var path = d3.geo.path()
    .projection(projection);
    
  queue()
    .defer(d3.json, '/data/us-states.json')
    .await(buildMap);

  function buildMap(error, states) {

    svg.selectAll(".states")
      .data(states.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr('class', 'states')
      .attr('id', function(d) { return d.properties.name.trim(); });

  }
</script>

