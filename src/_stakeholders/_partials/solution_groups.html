{% if page.subnav.show %}
  {% include nav/subnav.html items=page.solution_groups label=page.subnav.label %}
{% endif %}

{% for group in page.solution_groups %}
  {% capture editorRef %}solution_groups[{{ forloop.index0 }}]{% endcapture %}
  <section id="{{ group.label | slugify | default: 'all-solutions' }}" class="py-5">
    <div class="container">
      <div data-cms-editor-link="cloudcannon:#{{ editorRef }}" data-cms-editor-link-style="modal" class="row align-items-center cms-editor-link">
        <div class=" col-12 col-lg-9">
          <h3>{{ group.label }}</h3>
          <div>{{ group.description_html }}</div>
          {% if group.opportunities.size > 0 %}
            <ul>
              {% for opportunity in group.opportunities %}
              <li>{{ opportunity.label }}</li>
              {% endfor %}
            </ul>
          {% endif %}
          {% if group.link.url %}
            <a href="{{ group.link.url }}" title="{{ link.alt | default: site.default_cta }}" class="btn btn-dark my-5">{{ group.link.label | default: site.default_cta }}</a>
          {% endif %}

        </div>
        <div class="col-12 col-lg-3">
          {% capture editor-link %}#{{ editorRef }}.stat{% endcapture %}
          {% include charts/donut.html
            item=group.stat
            editor-link=editor-link
          %}
        </div>
      </div>

        <div class="solution-group">
          {% for category in site.action_area_categories %}
            <label>{{ category.label }}</label>
            {% for area in category.areas %}
              {% assign active_area = group.action_areas[area.slug] %}

              {% if page.slug == 'capital-providers' %}
                <!-- collapsible rows should only appear on Capital Providers page -->
                <div class="row row-{{ category.uid }} align-items-center" data-toggle="collapse" data-target="#{{ sector.uid }}-{{ area.uid }}">
                  <div class="col-lg-auto flex-lg-grow-1">
                    <div class="d-flex align-items-center">
                      <div class="col-auto">
                        <div class="icon icon-sm icon-{{ area.uid }} ml-3"></div>
                      </div>
                      <div class="col">
                        <h4 class="mb-0">{{ area.label }}</h4>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-auto ml-lg-auto">
                    <div class="d-flex align-items-center">
                      <div class="d-flex flex-column flex-lg-row align-items-center pr-4">
                        <span class="stat-number">
                          {{ active_area.solutions.size | default: '0' }}
                        </span>
                        <span class="stat-text">Modeled<br />Solutions</span>
                      </div>

                      <div class="d-flex flex-column flex-lg-row align-items-center pl-4 border-left">
                        <span class="stat-number">
                          ${{ active_area.total_investment_needed | default: '0' }}
                        </span>
                        <span class="stat-text">Financial Investment<br />Needed</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-lg-auto">
                    <div class="collapse-trigger mt-3 mt-lg-0 bg-prevention">
                      <span>Explore<br class="d-none d-lg-block" /> Solutions</span>
                      <span class="arrow arrow-down"></span>
                    </div>
                  </div>
                </div>
                <div class="collapse" id="{{ group.uid }}-{{ area.uid }}">
                  <div class="row my-3">
                    <div class="col-12">
                      <div class="bg-light text-prevention p-5">
                        <h5 class="text-serif editable global-editor-link">Overview</h5>
                        <p data-cms-editor-link="cloudcannon:#{{ editorRef }}.action_areas[{{ area.slug }}].summary" data-cms-editor-link-style="modal" class="cms-editor-link">
                          {{ active_area.summary }}
                        </p>
                        <div class="row">
                          <div class="col-md-auto">
                            <div class="stat-number">
                              ${{ active_area.total_investment_opportunity | default: '0' }}
                            </div>
                          </div>
                          <div class="col">
                            <h4 class="editable global-editor-link">Financing Opportunity</h4>
                            <p>{{ active_area.financing_opportunity_summary }}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {% for solution in active_area.solutions %}
                    <div class="row my-3">
                      <div class="col-4 col-lg-1">
                        <i class="icon icon-sm sticky"></i>
                      </div>
                      <div class="col-lg-11">
                        <h6 class="editable global-editor-link">Modeled Solution</h6>
                        <h4>{{ solution.label }}</h4>
                        <p>{{ solution.definition }}</p>
                        <div class="row">
                          <div class="col-md-auto">
                            <div class="stat-number">
                              ${{ solution.investment_needed | default: '0' }}
                            </div>
                          </div>
                          <div class="col">
                            <h4 class="editable global-editor-link">Investment Needed</h4>
                            <p>{{ solution.investment_needed_summary }}</p>
                          </div>
                        </div>

                        <h6 class="editable global-editor-link">Innovation Opportunities</h6>
                        <div>
                          {{ solution.innovation_opportunities_html }}
                        </div>
                        <div class="d-flex flex-column flex-lg-row">
                          <a href="{{ site.insights_engine_url }}/solution-database/{{ solution.slug }}" class="btn btn-link mr-4">See Solution Factsheet</a>
                          <a href="{{ site.insights_engine_url }}/solution-database/" class="btn btn-link">See Solution Provider Database</a>
                        </div>
                      </div>
                    </div>
                    {% unless forloop.last %}<hr />{% endunless %}
                  {% endfor %}
                </div>
              {% else %}
                <div class="row row-{{ category.uid }}">
                  <div class="col-12">
                    <div class="d-flex align-items-start">
                      <div class="col-auto">
                        <div class="icon icon-sm icon-{{ area.uid }} ml-3"></div>
                      </div>
                      <div class="col">
                        <h4 class="mt-3">{{ area.label }}</h4>
                        <div class="my-4">
                          <p class="text-serif editable global-editor-link">Key Opportunities</p>
                          <ul>
                            {% for opportunity in active_area.opportunities %}
                            <li>{{ opportunity.label }}</li>
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}

            {% endfor %}
          {% endfor %}
        </div>

    </div>
  </section>
{% endfor %}

